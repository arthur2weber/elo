version: '3.8'

services:
  elo-core:
    build:
      context: .
      dockerfile: docker/elo/Dockerfile
      args:
        GEMINI_CLI_INSTALL: ${GEMINI_CLI_INSTALL:-}
        GEMINI_GCLOUD_COMPONENT: ${GEMINI_GCLOUD_COMPONENT:-}
    restart: unless-stopped
    network_mode: host
    user: "0:0"
    cap_add:
      - NET_ADMIN
      - NET_RAW
    entrypoint: ["npm", "start"]
    depends_on:
      - go2rtc
    environment:
      - GEMINI_CLI_BIN=${GEMINI_CLI_BIN:-gemini}
      - GEMINI_CLI_ARGS=${GEMINI_CLI_ARGS:-}
      - GEMINI_CLI_PROMPT_ARG=${GEMINI_CLI_PROMPT_ARG:-}
      - GEMINI_API_KEY=${GEMINI_API_KEY:-}
      - GEMINI_API_MODEL=${GEMINI_API_MODEL:-}
      - GEMINI_API_BASE_URL=${GEMINI_API_BASE_URL:-}
      - THINKING_BUDGET=${THINKING_BUDGET:-}
      - CLOUDSDK_CONFIG=/gcloud
      - GO2RTC_URL=http://127.0.0.1:1984
    volumes:
      - ./:/app
      - /app/node_modules
      - gcloud_config:/gcloud
      - ./logs:/app/logs
      - ./automations:/app/automations

  go2rtc:
    image: alexxit/go2rtc
    container_name: go2rtc
    restart: unless-stopped
    network_mode: host
    privileged: true
    volumes:
      - ./go2rtc.yaml:/config/go2rtc.yaml

volumes:
  gcloud_config: